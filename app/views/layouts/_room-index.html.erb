<div class="rooms">
  <ul class="room-list">
    <% rooms.each do |room| %>
      <li class="room">
        <div class="room-card">
          <div class="image-area">
            <% if room.image? %>
              <%= image_tag room.image.url %>
            <% end %>
          </div>
          <h3 class="room-name">
            <%= room.name %>
          </h3>
          <% room_users = room.participating_users.all %>
          <% if logged_in? %>
            <% if room_users.where(id: current_user.id).exists? %>
              <%= link_to '参加', room_path(room), class: 'enter-btn'%>
            <% else %>
              <button class="enter-btn join-btn"
              onclick="
                $(this).parents('.room-card').next('.join-confirm').fadeIn();
              ">
                参加
              </button>
            <% end %>
          <% else %>
            <%= link_to '参加', login_path, remote: true, class: 'enter-btn' %>
          <% end %>
        </div>

        <div class="join-confirm">
          <div class="join-confirm-modal modal-inner">
            <h2 class="title">このルームに参加しますか？</h2>

            <div class="room-card">
              <div class="image-area">
              <% if room.image? %>
                <%= image_tag room.image.url %>
              <% end %>
              </div>
              <h3 class="room-name">
                <%= room.name %>
              </h3>
            </div>

            <%= link_to 'キャンセル', root_path, class: 'join-cancel-btn btn' %>
            <%= link_to '参加する', room_participations_path(room), method: :post, class: 'join-btn btn' %>
          </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>